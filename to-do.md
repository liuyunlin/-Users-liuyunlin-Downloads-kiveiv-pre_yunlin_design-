# Kiveiv Progress Log

- 2026-02-02: Initialize directory structure.
- 2026-02-02: Align document parsing UI with end-to-end parse-only flow, update settings panels, and wire mock document API stubs. (frontend/app/src/modules/document-parsing/DocumentProcess.jsx, frontend/app/src/modules/settings/constants.js, frontend/app/src/services/documentApi.js, frontend/app/src/modules/ModulePage.jsx)
- 2026-02-02: Produce frontend technical report for parsing/settings and extend it with chunk/extract/QA planning per skill. (docs/frontend_tech_report_2026-02-02.md)
- 2026-02-02: Update report with detailed chunk/extract/QA UI planning and Excel handling note (no separate module). (docs/frontend_tech_report_2026-02-02.md)
- 2026-02-02: Switch frontend branding to Kiveiv (logo, monochrome palette, remove Datacapsule references). (frontend/app/src/modules, frontend/app/src/index.css, frontend/app/src/design-system/DESIGN_SPEC.md)
- 2026-02-02: Add mock Text Segmentation page UI per skill/report (strategy, params, tags, validation, provenance, vectorization, history). (frontend/app/src/modules/document-segmentation/components/SegmentationPage.jsx, frontend/app/src/modules/ModulePage.jsx)
- 2026-02-02: Define chunk/extract/QA secondary menu IA in business skill docs and reflect it in the frontend report. (/Users/issuser/.codex/skills/kiveiv-architecture-build/references/logic_schema/kiveiv-business/*/references/business_flow.md, docs/frontend_tech_report_2026-02-02.md)
- 2026-02-02: Refactor text segmentation UI into IA-based tabs (strategy/results/tags/provenance/search/vectorization). (frontend/app/src/modules/document-segmentation/components/SegmentationPage.jsx, docs/frontend_tech_report_2026-02-02.md)
- 2026-02-02: Align segmentation secondary menu layout to left-rail list (same as document parsing) and sync to skill/report. (frontend/app/src/modules/document-segmentation/components/SegmentationPage.jsx, /Users/issuser/.codex/skills/kiveiv-architecture-build/references/logic_schema/kiveiv-business/chunk/references/business_flow.md, docs/frontend_tech_report_2026-02-02.md)
- 2026-02-02: Move segmentation secondary menu into main sidebar (like document parsing) and pass active tab to page content. (frontend/app/src/modules/ModulePage.jsx, frontend/app/src/modules/document-segmentation/components/SegmentationPage.jsx, docs/frontend_tech_report_2026-02-02.md)
- 2026-02-02: Move parse config out of Settings into document parsing sub-menu “解析策略” and remove config management tabs from Settings. (frontend/app/src/modules/document-parsing/ParseStrategyPage.jsx, frontend/app/src/modules/settings/constants.js, frontend/app/src/modules/ModulePage.jsx, docs/frontend_tech_report_2026-02-02.md)
- 2026-02-02: Re-spec segmentation flow to match hit-rag backend (doc list → stepper strategy → process → per-doc results; tags/search/vectorization as derived menus). (docs/frontend_tech_report_2026-02-02.md, /Users/issuser/.codex/skills/kiveiv-architecture-build/references/logic_schema/kiveiv-business/chunk/references/business_flow.md)
- 2026-02-02: Rebuild segmentation UI to match hit-rag flow (doc list + stepper strategy + results + tags/search/vectorization menus). (frontend/app/src/modules/document-segmentation/components/SegmentationPage.jsx, frontend/app/src/modules/ModulePage.jsx, docs/frontend_tech_report_2026-02-02.md)
- 2026-02-02: Adjust segmentation layout (strategy panel appears only after selection; failure status in red) and extend Settings with segmentation/index model configs + multi-config add. (frontend/app/src/modules/document-segmentation/components/SegmentationPage.jsx, frontend/app/src/modules/settings/SettingsPage.jsx, frontend/app/src/modules/settings/constants.js, frontend/app/src/modules/settings/SettingsStore.jsx, docs/frontend_tech_report_2026-02-02.md)
- 2026-02-02: Update segmentation flow spec to separate strategy page, enforce selectable statuses, allow re-segmentation, and gate results by explicit “查看结果”; sync to skill + report. (/Users/issuser/.codex/skills/kiveiv-architecture-build/references/logic_schema/kiveiv-business/chunk/references/business_flow.md, docs/frontend_tech_report_2026-02-02.md)
- 2026-02-02: Implement segmentation flow restructure (separate strategy page, selection constraints, re-seg entry, results gating, edit modal with status update, version/trace placeholders). (frontend/app/src/modules/document-segmentation/components/SegmentationPage.jsx, docs/frontend_tech_report_2026-02-02.md)
- 2026-02-02: Expand segmentation UI for tag management actions, semantic search multi-select filters, and vectorization doc→detail→config flow. (frontend/app/src/modules/document-segmentation/components/SegmentationPage.jsx, docs/frontend_tech_report_2026-02-02.md, /Users/issuser/.codex/skills/kiveiv-architecture-build/references/logic_schema/kiveiv-business/chunk/references/business_flow.md)
- 2026-02-02: Align model-selection requirements (remove parse strategy submenu, add model picker modals for parsing/semantic segmentation/vectorization, index model uses LLM) and sync to skills + frontend report. (docs/frontend_tech_report_2026-02-02.md, /Users/issuser/.codex/skills/kiveiv-architecture-build/references/logic_schema/kiveiv-business/frontend/references/business_flow.md, /Users/issuser/.codex/skills/kiveiv-architecture-build/references/logic_schema/kiveiv-business/chunk/references/business_flow.md)
- 2026-02-02: Add progress modals and “查看进度” re-entry for segmentation + vectorization tasks. (frontend/app/src/modules/document-segmentation/components/SegmentationPage.jsx)
- 2026-02-03: Replace inline segmentation results with a dedicated detail view (doc info + params + square chunk tiles + edit/version/trace actions). (frontend/app/src/modules/document-segmentation/components/SegmentationPage.jsx)
- 2026-02-03: Define tag management detail view (same-page switch, square chunk cards, per-chunk tag add/remove with system/normal split, local cache) in skill/report. (/Users/issuser/.codex/skills/kiveiv-architecture-build/references/logic_schema/kiveiv-business/chunk/references/business_flow.md, docs/frontend_tech_report_2026-02-02.md)
- 2026-02-03: Implement tag management detail view + local tag cache (action buttons repositioned, clickable tags, per-chunk add/remove for normal/system tags). (frontend/app/src/modules/document-segmentation/components/SegmentationPage.jsx)
- 2026-02-03: Add chunk filter/select/delete flow in segmentation result detail (checkboxes, select-all, confirm delete, local cache sync). (frontend/app/src/modules/document-segmentation/components/SegmentationPage.jsx)
- 2026-02-03: Sync segmentation result filter/delete interaction into chunk skill + frontend report. (/Users/issuser/.codex/skills/kiveiv-architecture-build/references/logic_schema/kiveiv-business/chunk/references/business_flow.md, docs/frontend_tech_report_2026-02-02.md)
- 2026-02-03: Split segmentation UI into five subpages aligned with secondary menu (docs/results/tags/search/vector). (frontend/app/src/modules/document-segmentation/components/SegmentationPage.jsx, frontend/app/src/modules/document-segmentation/components/pages)
- 2026-02-03: Align vectorization detail UX (独立详情页、正方形卡片、筛选/全选/删除) into frontend skill + chunk flow + report. (/Users/issuser/.codex/skills/kiveiv-architecture-build/references/logic_schema/kiveiv-business/frontend/SKILL.md, /Users/issuser/.codex/skills/kiveiv-architecture-build/references/logic_schema/kiveiv-business/frontend/references/business_flow.md, /Users/issuser/.codex/skills/kiveiv-architecture-build/references/logic_schema/kiveiv-business/chunk/references/business_flow.md, docs/frontend_tech_report_2026-02-02.md)
- 2026-02-03: Finalize index-building (extract) IA decisions: task→detail jump, stepwise task creation modal (type→model→tags/fields), and place graph query/visualization in aggregation page; sync to skills + report. (/Users/issuser/.codex/skills/kiveiv-architecture-build/references/logic_schema/kiveiv-business/extract/references/business_flow.md, /Users/issuser/.codex/skills/kiveiv-architecture-build/references/logic_schema/kiveiv-business/frontend/references/business_flow.md, docs/frontend_tech_report_2026-02-02.md)
- 2026-02-03: Reshape extraction IA: add “抽取任务”入口页 (切片/Excel 双卡), rename task list to “抽取结果”, define stepwise extraction config (精确/模糊 + 图结构/结构化 + 参考输入/标签), and Excel-only precise structured flow; sync to skills + report. (/Users/issuser/.codex/skills/kiveiv-architecture-build/references/logic_schema/kiveiv-business/extract/references/business_flow.md, /Users/issuser/.codex/skills/kiveiv-architecture-build/references/logic_schema/kiveiv-business/frontend/references/business_flow.md, docs/frontend_tech_report_2026-02-02.md)
- 2026-02-03: Extend extraction entry with “历史任务覆盖” flow (only completed selectable, params locked except model, structured Excel header mismatch warning, overwrite same-name results); sync to skills + report. (/Users/issuser/.codex/skills/kiveiv-architecture-build/references/logic_schema/kiveiv-business/extract/references/business_flow.md, /Users/issuser/.codex/skills/kiveiv-architecture-build/references/logic_schema/kiveiv-business/frontend/references/business_flow.md, docs/frontend_tech_report_2026-02-02.md)
- 2026-02-04: Define single-page Intelligent QA layout (left session list + center chat with streaming/trace + in-chat citations + right config) and add mock data cases; sync to QA skill + frontend report. (/Users/issuser/.codex/skills/kiveiv-architecture-build/references/logic_schema/kiveiv-business/qa/references/business_flow.md, docs/frontend_tech_report_2026-02-02.md)
- 2026-02-04: Isolate segmentation and index-building state by knowledge base (segmentation docs/chunks/tags/progress + extraction tasks/progress stored per base, localStorage). (frontend/app/src/modules/document-segmentation, frontend/app/src/modules/index-building/hooks/useExtractionTasks.js)
- 2026-02-04: Isolate document parsing state by knowledge base (documents/progress/process/contents per baseId) and sync progress/status back to filesByBase cache to avoid cross-KB contamination. (frontend/app/src/modules/document-parsing/documentStore.jsx, frontend/app/src/modules/knowledge-base/components/KnowledgeBaseWorkspace.jsx)
- 2026-02-04: Plan lifecycle status aggregation (parse/segment/index) with a unified hook and consistent UI badges across file system, document list, segmentation list, and index building entry; no cross-store writes. (/Users/issuser/.codex/skills/kiveiv-architecture-build/references/logic_schema/kiveiv-business/frontend/references/business_flow.md, docs/frontend_tech_report_2026-02-02.md)

## Planned
- 文档解析去除“解析策略”二级菜单，解析详情页改为模型下拉选择（默认已保存，禁空，含“返回重新配置”跳转 Settings）。
- 语义切分“开始切分”弹窗仅选 LLM 模型；向量化弹窗仅选向量模型，其他参数读取 Settings 配置。
- 文本切分模型默认提供 LLM/向量两类占位；索引构建模型改为 LLM 占位。
- 长任务进度统一为“进度弹窗”模式（解析/切分/向量化/索引构建等）：可关闭、列表/详情“查看进度”可恢复弹窗。
- 文本切分与后端联调（状态/切分触发/chunk 列表/日志/向量化）。
- 抽取策略/提示词由标签自动生成（替代固定提示词，待后端能力支持）。
- 新增抽取模块并按二级菜单实现（方案A）：
  - 抽取任务 / 图结构抽取 / 图谱聚合 / 结构化抽取 / 结果与导出。
  - 标签筛选默认 AND；抽取结果按标签叠加累积；图谱聚合由用户选择已完成结果。
  - Excel 自动抽取（结构化 + 图结构），图结构基于表头字段生成三元组。
- 抽取任务支持“历史任务覆盖”入口：仅已完成可选，参数锁定（仅模型可选），结构化 Excel 表头不一致提示新增列。
- 新增智能问答模块并按二级菜单实现：
  - 改为单页三栏（左会话/中对话/右配置），对话区内嵌知识源溯源与白盒链路。
- 调整上传逻辑允许 Excel 文件并交由后端 pipeline 处理（替换当前“阻断 Excel”提示）。
- 为切分/抽取/问答新增 mock API stub 与前端状态管理。
- 切分/抽取/问答页面补充 mock 数据与状态演示（溯源链路、版本/统计、外搜占位）。
- 完成 DocumentList/DocumentViewer/DocumentEditor 与 mock API 的联动与状态同步。
- Settings 配置持久化（本地存储或 mock 接口）。
- 文档解析模块 UI 细节对齐设计系统（间距、层级、文案一致性）。
